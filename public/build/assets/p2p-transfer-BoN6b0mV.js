import{r as l,j as e,H as A,a as f}from"./app-0Ecocu1u.js";import{c as _,B as o}from"./button-VVRKX4IP.js";import{B as P}from"./badge-Bdd0Hver.js";import{L as n}from"./label-DYZTphK5.js";import{b as h,F as i,q as b,a as R}from"./index-BCUVCiTI.js";/* empty css            */import"./index-d7wcCOPT.js";import"./iconBase-BhcFl9-0.js";const N=l.forwardRef(({className:c,...s},u)=>e.jsx("textarea",{className:_("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",c),ref:u,...s}));N.displayName="Textarea";function L({transfer:c}){const[s,u]=l.useState(c),[m,g]=l.useState(c.remaining_time||0),[x,j]=l.useState(""),[v,p]=l.useState(!1);l.useEffect(()=>{const r=setInterval(async()=>{try{const a=await(await fetch(`/api/p2p-transfer/${s.id}/status`)).json();a.status!==s.status&&u(T=>({...T,status:a.status})),a.remaining_time!==null&&g(a.remaining_time),a.status==="released"&&setTimeout(()=>{window.location.href="/orders"},2e3)}catch(t){console.error("Error polling status:",t)}},1e3);return()=>clearInterval(r)},[s.id,s.status]),l.useEffect(()=>{if(m<=0)return;const r=setInterval(()=>{g(t=>t<=1?0:t-1)},1e3);return()=>clearInterval(r)},[m]);const y=r=>{const t=Math.floor(r/60),a=r%60;return`${t}:${a.toString().padStart(2,"0")}`},w=()=>{f.post(`/p2p-transfer/${s.id}/payment-completed`,{},{preserveScroll:!0})},k=()=>{f.post(`/p2p-transfer/${s.id}/release`,{},{preserveScroll:!0})},S=()=>{x.trim()&&f.post(`/p2p-transfer/${s.id}/appeal`,{reason:x},{preserveScroll:!0,onSuccess:()=>{p(!1),j("")}})},d=(()=>{switch(s.status){case"pending":return{variant:"warning",icon:h,label:"Waiting for Payment",color:"text-yellow-600"};case"payment_completed":return{variant:"success",icon:i,label:"Payment Completed",color:"text-green-600"};case"released":return{variant:"success",icon:i,label:"Released",color:"text-green-600"};case"appealed":return{variant:"error",icon:b,label:"Under Appeal",color:"text-red-600"};default:return{variant:"default",icon:h,label:s.status,color:"text-foreground"}}})(),C=d.icon;return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:`P2P Transfer - ${s.order_number}`}),e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsxs("div",{className:"bg-card border border-border rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-accent border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"P2P Transfer"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Order #",s.order_number]})]}),e.jsxs(P,{variant:d.variant,className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:d.label})]})]})}),m>0&&(s.status==="pending"||s.status==="payment_completed")&&e.jsx("div",{className:"bg-accent border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:`w-5 h-5 ${d.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.status==="pending"?"Payment Deadline":"Auto-Release Timer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.status==="pending"?"Complete payment within 15 minutes":"Will auto-release in 5 minutes if no action taken"})]})]}),e.jsx("div",{className:`text-3xl font-bold font-mono ${d.color}`,children:y(m)})]})}),e.jsx("div",{className:"px-6 py-6 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-4",children:[s.nft_image&&e.jsx("img",{src:s.nft_image,alt:s.nft_name,className:"w-20 h-20 rounded-lg object-cover border border-border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s.nft_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"NFT Transfer via P2P"})]})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-foreground mb-4",children:"Payment Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:[s.amount," ETH"]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Network"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.network})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.payment_method})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Partner Address"}),e.jsx("p",{className:"text-xs font-mono text-foreground break-all",children:s.partner_address})]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Sender Address"}),e.jsx("p",{className:"text-xs font-mono text-foreground break-all mt-1",children:s.sender_address})]})]}),s.status==="pending"&&e.jsx("div",{className:"px-6 py-4 bg-accent border-t border-border",children:e.jsxs(o,{onClick:w,className:"w-full gap-2",size:"lg",children:[e.jsx(i,{className:"w-5 h-5"}),"Payment Completed"]})}),s.status==="payment_completed"&&e.jsxs("div",{className:"px-6 py-4 bg-accent border-t border-border space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(o,{onClick:k,variant:"default",className:"gap-2",children:[e.jsx(i,{className:"w-4 h-4"}),"Release Now"]}),e.jsxs(o,{onClick:()=>p(!0),variant:"outline",className:"gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Appeal"]})]}),e.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Transfer will auto-release if no action is taken within 5 minutes"})]}),s.status==="released"&&e.jsx("div",{className:"px-6 py-4 bg-green-500/10 border-t border-green-500/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(i,{className:"w-12 h-12 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"Transfer Released Successfully!"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Redirecting to orders..."})]})}),s.status==="appealed"&&e.jsx("div",{className:"px-6 py-4 bg-yellow-500/10 border-t border-yellow-500/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"w-12 h-12 text-yellow-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-yellow-600",children:"Appeal Submitted"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Admin will review your case shortly"})]})})]})})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:"Submit Appeal"}),e.jsx("button",{onClick:()=>p(!1),className:"text-muted-foreground hover:text-foreground",children:e.jsx(R,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"appeal-reason",children:"Reason for Appeal *"}),e.jsx(N,{id:"appeal-reason",placeholder:"Explain why you're appealing this transfer...",value:x,onChange:r=>j(r.target.value),className:"mt-2 min-h-[120px]"})]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-yellow-700 dark:text-yellow-400",children:[e.jsx("strong",{children:"Note:"})," Once appealed, an admin will review your case. The transfer will be on hold until resolved."]})})]}),e.jsxs("div",{className:"border-t border-border px-6 py-4 flex gap-3",children:[e.jsx(o,{variant:"outline",onClick:()=>p(!1),className:"flex-1",children:"Cancel"}),e.jsx(o,{onClick:S,disabled:!x.trim(),className:"flex-1",children:"Submit Appeal"})]})]})})]})}export{L as default};
