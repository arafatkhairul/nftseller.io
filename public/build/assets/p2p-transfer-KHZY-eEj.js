import{r as n,j as e,H as C,b as g}from"./app-COTYBvsO.js";import{B as S}from"./badge-DDBQUlkY.js";import{B as i}from"./button-Bj-zvocR.js";import{L as d}from"./label-4rBvpyJj.js";import{T}from"./textarea-BFa_W9xp.js";import{b as u,F as l,t as p,a as h}from"./index-CFxIt8s5.js";/* empty css            */import"./index-CJw6_QVN.js";import"./iconBase-BlCTSstH.js";function L({transfer:f}){const[s,N]=n.useState(f),[c,b]=n.useState(f.remaining_time||0),[m,j]=n.useState(""),[v,x]=n.useState(!1);n.useEffect(()=>{const t=setInterval(async()=>{try{const a=await(await fetch(`/api/p2p-transfer/${s.id}/status`)).json();a.status!==s.status&&N(A=>({...A,status:a.status})),a.remaining_time!==null&&b(a.remaining_time),a.status==="released"&&setTimeout(()=>{window.location.href="/"},2e3)}catch(r){console.error("Error polling status:",r)}},1e3);return()=>clearInterval(t)},[s.id,s.status]),n.useEffect(()=>{if(c<=0)return;const t=setInterval(()=>{b(r=>r<=1?0:r-1)},1e3);return()=>clearInterval(t)},[c]);const y=t=>{const r=Math.floor(t/60),a=t%60;return`${r}:${a.toString().padStart(2,"0")}`},w=()=>{g.post(`/p2p-transfer/${s.transfer_code}/payment-completed`,{},{preserveScroll:!0})},_=()=>{m.trim()&&g.post(`/p2p-transfer/${s.id}/appeal`,{reason:m},{preserveScroll:!0,onSuccess:()=>{x(!1),j("")}})},o=(()=>{switch(s.status){case"pending":return{variant:"warning",icon:u,label:"Waiting for Payment",color:"text-yellow-600"};case"payment_completed":return{variant:"success",icon:l,label:"Payment Completed",color:"text-green-600"};case"released":return{variant:"success",icon:l,label:"Released",color:"text-green-600"};case"appealed":return{variant:"error",icon:p,label:"Under Appeal",color:"text-red-600"};case"appeal_rejected":return{variant:"destructive",icon:h,label:"Appeal Rejected",color:"text-red-600"};case"cancelled":return{variant:"secondary",icon:l,label:"Appeal Approved",color:"text-blue-600"};default:return{variant:"default",icon:u,label:s.status,color:"text-foreground"}}})(),k=o.icon;return e.jsxs(e.Fragment,{children:[e.jsx(C,{title:`P2P Transfer - ${s.order_number}`}),e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsxs("div",{className:"bg-card border border-border rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-accent border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"P2P Transfer"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Order #",s.order_number]})]}),e.jsxs(S,{variant:o.variant,className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:o.label})]})]})}),c>0&&(s.status==="pending"||s.status==="payment_completed")&&e.jsx("div",{className:"bg-accent border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:`w-5 h-5 ${o.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.status==="pending"?"Payment Deadline":"Auto-Release Timer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.status==="pending"?`Complete payment within ${s.payment_deadline_minutes} minutes`:`Will auto-release in ${s.auto_release_minutes} minutes if no action taken`})]})]}),e.jsx("div",{className:`text-3xl font-bold font-mono ${o.color}`,children:y(c)})]})}),e.jsx("div",{className:"px-6 py-6 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-4",children:[s.nft_image&&e.jsx("img",{src:s.nft_image,alt:s.nft_name,className:"w-20 h-20 rounded-lg object-cover border border-border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s.nft_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"NFT Transfer via P2P"})]})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-foreground mb-4",children:"Payment Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-xs text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:[s.amount," ETH"]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-xs text-muted-foreground",children:"Network"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.network})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-xs text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.payment_method})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-xs text-muted-foreground",children:"Sending NFT to this address"}),e.jsx("p",{className:"text-xs font-mono text-foreground break-all",children:s.partner_address})]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-xs text-muted-foreground",children:"Sender Address"}),e.jsx("p",{className:"text-xs font-mono text-foreground break-all mt-1",children:s.sender_address})]})]}),s.status==="pending"&&e.jsx("div",{className:"px-6 py-4 bg-accent border-t border-border",children:e.jsxs(i,{onClick:w,className:"w-full gap-2",size:"lg",children:[e.jsx(l,{className:"w-5 h-5"}),"Payment Completed"]})}),s.status==="payment_completed"&&e.jsxs("div",{className:"px-6 py-8 bg-accent border-t border-border space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto ring-8 ring-green-500/5 mb-4",children:e.jsx(l,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-bold text-foreground",children:"Payment Marked as Completed"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 max-w-sm mx-auto",children:"Please wait while the seller verifies your payment. The asset will be released automatically once verified."})]}),e.jsx("div",{className:"bg-background border border-border rounded-lg p-4 max-w-sm mx-auto",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-primary border-t-transparent rounded-full"}),e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Waiting for seller confirmation..."})]})}),e.jsx("div",{className:"flex justify-center pt-2",children:e.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>x(!0),className:"text-muted-foreground hover:text-red-500",children:[e.jsx(p,{className:"w-4 h-4 mr-2"}),"Report an Issue / Appeal"]})})]}),s.status==="released"&&e.jsx("div",{className:"px-6 py-4 bg-green-500/10 border-t border-green-500/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(l,{className:"w-12 h-12 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"Transfer Released Successfully!"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Redirecting to home..."})]})}),s.status==="appealed"&&e.jsx("div",{className:"px-6 py-4 bg-yellow-500/10 border-t border-yellow-500/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{className:"w-12 h-12 text-yellow-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-yellow-600",children:"Appeal Submitted"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Admin will review your case shortly."})]})}),s.status==="appeal_rejected"&&e.jsx("div",{className:"px-6 py-4 bg-red-500/10 border-t border-red-500/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{className:"w-12 h-12 text-red-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-red-600",children:"Appeal Rejected"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Your appeal has been rejected by the admin."})]})}),s.status==="cancelled"&&e.jsx("div",{className:"px-6 py-4 bg-blue-500/10 border-t border-blue-500/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(l,{className:"w-12 h-12 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"Appeal Approved"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"You can now retry the transfer or place a new order."}),e.jsx(i,{variant:"link",className:"mt-2 text-blue-600",onClick:()=>window.location.href="/orders",children:"Go to Orders"})]})})]}),e.jsx("div",{className:"mt-6 text-center animate-in fade-in slide-in-from-bottom-4 duration-700 delay-300",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-muted/50 border border-border/50 backdrop-blur-sm",children:[e.jsx(p,{className:"w-3.5 h-3.5 text-muted-foreground"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Need assistance? ",e.jsx("a",{href:"/login",className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Login"})," or ",e.jsx("a",{href:"/register",className:"text-primary hover:text-primary/80 font-medium transition-colors",children:"Register"})," to contact support."]})]})})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:"Submit Appeal"}),e.jsx("button",{onClick:()=>x(!1),className:"text-muted-foreground hover:text-foreground",children:e.jsx(h,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"appeal-reason",children:"Reason for Appeal *"}),e.jsx(T,{id:"appeal-reason",placeholder:"Explain why you're appealing this transfer...",value:m,onChange:t=>j(t.target.value),className:"mt-2 min-h-[120px]"})]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-yellow-700 dark:text-yellow-400",children:[e.jsx("strong",{children:"Note:"})," Once appealed, an admin will review your case. The transfer will be on hold until resolved."]})})]}),e.jsxs("div",{className:"border-t border-border px-6 py-4 flex gap-3",children:[e.jsx(i,{variant:"outline",onClick:()=>x(!1),className:"flex-1",children:"Cancel"}),e.jsx(i,{onClick:_,disabled:!m.trim(),className:"flex-1",children:"Submit Appeal"})]})]})})]})}export{L as default};
