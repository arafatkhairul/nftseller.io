import{r as l,j as e,H as C,a as b}from"./app-y1ZB5c9x.js";import{B as P}from"./badge-YGhNNr7I.js";import{B as x}from"./button-CX5HfBYh.js";import{L as n}from"./label-Ccpzj8oe.js";import{T}from"./textarea-BkWIGvV7.js";import{b as u,F as o,r as g,a as _}from"./index-dbElndna.js";/* empty css            */import"./index-gDNE8eHE.js";import"./iconBase-CV3Sr50B.js";function z({transfer:p}){const[s,j]=l.useState(p),[i,f]=l.useState(p.remaining_time||0),[c,h]=l.useState(""),[N,m]=l.useState(!1);l.useEffect(()=>{const r=setInterval(async()=>{try{const a=await(await fetch(`/api/p2p-transfer/${s.id}/status`)).json();a.status!==s.status&&j(k=>({...k,status:a.status})),a.remaining_time!==null&&f(a.remaining_time),a.status==="released"&&setTimeout(()=>{window.location.href="/orders"},2e3)}catch(t){console.error("Error polling status:",t)}},1e3);return()=>clearInterval(r)},[s.id,s.status]),l.useEffect(()=>{if(i<=0)return;const r=setInterval(()=>{f(t=>t<=1?0:t-1)},1e3);return()=>clearInterval(r)},[i]);const v=r=>{const t=Math.floor(r/60),a=r%60;return`${t}:${a.toString().padStart(2,"0")}`},y=()=>{b.post(`/p2p-transfer/${s.id}/payment-completed`,{},{preserveScroll:!0})},w=()=>{c.trim()&&b.post(`/p2p-transfer/${s.id}/appeal`,{reason:c},{preserveScroll:!0,onSuccess:()=>{m(!1),h("")}})},d=(()=>{switch(s.status){case"pending":return{variant:"warning",icon:u,label:"Waiting for Payment",color:"text-yellow-600"};case"payment_completed":return{variant:"success",icon:o,label:"Payment Completed",color:"text-green-600"};case"released":return{variant:"success",icon:o,label:"Released",color:"text-green-600"};case"appealed":return{variant:"error",icon:g,label:"Under Appeal",color:"text-red-600"};default:return{variant:"default",icon:u,label:s.status,color:"text-foreground"}}})(),S=d.icon;return e.jsxs(e.Fragment,{children:[e.jsx(C,{title:`P2P Transfer - ${s.order_number}`}),e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsxs("div",{className:"bg-card border border-border rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-accent border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"P2P Transfer"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Order #",s.order_number]})]}),e.jsxs(P,{variant:d.variant,className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:d.label})]})]})}),i>0&&(s.status==="pending"||s.status==="payment_completed")&&e.jsx("div",{className:"bg-accent border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:`w-5 h-5 ${d.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.status==="pending"?"Payment Deadline":"Auto-Release Timer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.status==="pending"?"Complete payment within 15 minutes":"Will auto-release in 5 minutes if no action taken"})]})]}),e.jsx("div",{className:`text-3xl font-bold font-mono ${d.color}`,children:v(i)})]})}),e.jsx("div",{className:"px-6 py-6 border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-4",children:[s.nft_image&&e.jsx("img",{src:s.nft_image,alt:s.nft_name,className:"w-20 h-20 rounded-lg object-cover border border-border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:s.nft_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"NFT Transfer via P2P"})]})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-foreground mb-4",children:"Payment Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:[s.amount," ETH"]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Network"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.network})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Payment Method"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.payment_method})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Partner Address"}),e.jsx("p",{className:"text-xs font-mono text-foreground break-all",children:s.partner_address})]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{className:"text-xs text-muted-foreground",children:"Sender Address"}),e.jsx("p",{className:"text-xs font-mono text-foreground break-all mt-1",children:s.sender_address})]})]}),s.status==="pending"&&e.jsx("div",{className:"px-6 py-4 bg-accent border-t border-border",children:e.jsxs(x,{onClick:y,className:"w-full gap-2",size:"lg",children:[e.jsx(o,{className:"w-5 h-5"}),"Payment Completed"]})}),s.status==="payment_completed"&&e.jsxs("div",{className:"px-6 py-8 bg-accent border-t border-border space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto ring-8 ring-green-500/5 mb-4",children:e.jsx(o,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-bold text-foreground",children:"Payment Marked as Completed"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 max-w-sm mx-auto",children:"Please wait while the seller verifies your payment. The asset will be released automatically once verified."})]}),e.jsx("div",{className:"bg-background border border-border rounded-lg p-4 max-w-sm mx-auto",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-primary border-t-transparent rounded-full"}),e.jsx("p",{className:"text-xs font-medium text-foreground",children:"Waiting for seller confirmation..."})]})})]}),s.status==="released"&&e.jsx("div",{className:"px-6 py-4 bg-green-500/10 border-t border-green-500/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(o,{className:"w-12 h-12 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-green-600",children:"Transfer Released Successfully!"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Redirecting to orders..."})]})}),s.status==="appealed"&&e.jsx("div",{className:"px-6 py-4 bg-yellow-500/10 border-t border-yellow-500/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"w-12 h-12 text-yellow-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-semibold text-yellow-600",children:"Appeal Submitted"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Admin will review your case shortly"})]})})]})})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-card border border-border rounded-xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"border-b border-border px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:"Submit Appeal"}),e.jsx("button",{onClick:()=>m(!1),className:"text-muted-foreground hover:text-foreground",children:e.jsx(_,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"px-6 py-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"appeal-reason",children:"Reason for Appeal *"}),e.jsx(T,{id:"appeal-reason",placeholder:"Explain why you're appealing this transfer...",value:c,onChange:r=>h(r.target.value),className:"mt-2 min-h-[120px]"})]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-yellow-700 dark:text-yellow-400",children:[e.jsx("strong",{children:"Note:"})," Once appealed, an admin will review your case. The transfer will be on hold until resolved."]})})]}),e.jsxs("div",{className:"border-t border-border px-6 py-4 flex gap-3",children:[e.jsx(x,{variant:"outline",onClick:()=>m(!1),className:"flex-1",children:"Cancel"}),e.jsx(x,{onClick:w,disabled:!c.trim(),className:"flex-1",children:"Submit Appeal"})]})]})})]})}export{z as default};
